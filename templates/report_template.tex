\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{caption}
\usepackage{array}
\usepackage{lastpage}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{makecell}
\usepackage{float}
\usepackage{colortbl}

\geometry{margin=1in}
\setlength{\parindent}{0pt}

% Define colors
\definecolor{primary}{RGB}{30, 58, 138}
\definecolor{secondary}{RGB}{79, 70, 229}
\definecolor{success}{RGB}{16, 185, 129}
\definecolor{warning}{RGB}{245, 158, 11}
\definecolor{danger}{RGB}{239, 68, 68}
\definecolor{lightgray}{RGB}{240, 240, 240}
\definecolor{headercolor}{RGB}{44, 62, 80}
\definecolor{tableheader}{RGB}{52, 152, 219}

% Fix headheight warning
\setlength{\headheight}{15pt}

% Header and footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textbf{\textcolor{headercolor}{ {{ title }} }}}
\fancyhead[R]{\thepage\ of \pageref{LastPage}}
\fancyfoot[L]{AI-Powered Tender Evaluation System}
\fancyfoot[R]{Generated on {{ date }}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\title{\textbf{\textcolor{primary}{ {{ title }} }}}
\date{Generated on {{ date }}}
\author{AI Tender Evaluation System}

% Custom commands for better formatting
\newcommand{\insightbox}[1]{
    \begin{center}
    \colorbox{lightgray}{
        \begin{minipage}{0.9\textwidth}
        \textbf{Key Insight:} #1
        \end{minipage}
    }
    \end{center}
}

\begin{document}

\begin{titlepage}
\centering
\vspace*{2cm}

{\Huge \textbf{\textcolor{primary}{ {{ title }} }}}\\[1cm]

\vspace{1cm}

{\Large \textbf{AI-Powered Tender Evaluation Report}}\\[0.5cm]

\vspace{1cm}

{\large Generated on {{ date }}}\\[0.5cm]

\vspace{2cm}

\textbf{Confidential}\\
This document contains confidential information and is intended solely for the use of the organization that requested this evaluation.

\vfill

{\large AI Tender Evaluation System}\\
\textbf{Automated Document Analysis Platform}

\end{titlepage}

\tableofcontents
\newpage

\section{Executive Summary}
This report presents the evaluation results of tender proposals against the organization's requirements. The evaluation was performed using AI-powered analysis including semantic similarity matching and LLM-based reasoning.

\insightbox{The top-ranked proposal demonstrates strong alignment with technical requirements and offers competitive pricing while meeting all timeline constraints.}

\section{Organization Requirements Overview}
\begin{itemize}
{% for requirement in requirements %}
    \item {{ requirement | truncate(200) }}
{% endfor %}
\end{itemize}

\section{Evaluation Results Summary}
\begin{table}[H]
\centering
\begin{tabularx}{\textwidth}{|>{\bfseries}l|X|}
\hline
\multicolumn{2}{|>{\columncolor{tableheader}}c|}{\textcolor{white}{\textbf{Metrics}}} \\
\hline
\rowcolor{lightgray}
\textbf{Metric} & \textbf{Value} \\
\hline
Total Applicants Evaluated & {{ summary_stats.total_applicants }} \\
Average Compliance Score & {{ "%.1f"|format(summary_stats.average_score) }} \\
Top Applicant Score & {{ "%.1f"|format(summary_stats.highest_score) }} \\
Lowest Applicant Score & {{ "%.1f"|format(summary_stats.lowest_score) }} \\
\hline
\end{tabularx}
\caption{Evaluation Summary}
\end{table}

{% if applicants %}
\section{Detailed Comparison Table}
\begin{longtable}{|c|p{3.5cm}|c|c|p{4cm}|p{3cm}|}
\hline
\multicolumn{6}{|>{\columncolor{tableheader}}c|}{\textcolor{white}{\textbf{Detailed Comparison Table}}} \\
\hline
\rowcolor{lightgray}
\textbf{Rank} & \textbf{Applicant} & \textbf{Similarity} & \textbf{Compliance} & \textbf{Explanation} & \textbf{Key Strengths} \\
\hline
\endfirsthead
\hline
\rowcolor{tableheader}
\textcolor{white}{\textbf{Rank}} & \textcolor{white}{\textbf{Applicant}} & \textcolor{white}{\textbf{Similarity}} & \textcolor{white}{\textbf{Compliance}} & \textcolor{white}{\textbf{Explanation}} & \textcolor{white}{\textbf{Key Strengths}} \\
\hline
\endhead
\hline
\endfoot
\hline
\endlastfoot
{% for applicant in applicants %}
{{ applicant.rank }} & {{ applicant.name }} & {{ "%.3f"|format(applicant.similarity_score) }} & {{ applicant.score }}/100 & {{ applicant.explanation | truncate(80) }} & {{ applicant.strengths | truncate(60) }} \\
\hline
{% endfor %}
\end{longtable}

\section{Match Analysis Dashboard}
\begin{longtable}{|c|p{3.5cm}|c|c|c|c|}
\hline
\multicolumn{6}{|>{\columncolor{tableheader}}c|}{\textcolor{white}{\textbf{Match Analysis Dashboard}}} \\
\hline
\rowcolor{lightgray}
\textbf{Rank} & \textbf{Applicant} & \textbf{Technical} & \textbf{Financial} & \textbf{Timeline} & \textbf{Overall} \\
\hline
\endfirsthead
\hline
\rowcolor{tableheader}
\textcolor{white}{\textbf{Rank}} & \textcolor{white}{\textbf{Applicant}} & \textcolor{white}{\textbf{Technical}} & \textcolor{white}{\textbf{Financial}} & \textcolor{white}{\textbf{Timeline}} & \textcolor{white}{\textbf{Overall}} \\
\hline
\endhead
\hline
\endfoot
\hline
\endlastfoot
{% for entry in comparison_table %}
{{ entry.rank }} & {{ entry.name }} & {{ entry.technical_match }}\% & {{ entry.financial_match }}\% & {{ entry.timeline_match }}\% & {{ entry.overall_score }}/100 \\
\hline
{% endfor %}
\end{longtable}

\section{Detailed Applicant Analysis}
{% for applicant in applicants %}
\subsection{Rank {{ applicant.rank }}: {{ applicant.name }}}
\begin{table}[H]
\centering
\begin{tabularx}{\textwidth}{|>{\bfseries}l|X|}
\hline
\rowcolor{lightgray}
Metric & Value \\
\hline
Compliance Score & {{ applicant.score }}/100 \\
Similarity Score & {{ "%.3f"|format(applicant.similarity_score) }} \\
Technical Match & {{ applicant.technical_match }}\% \\
Financial Match & {{ applicant.financial_match }}\% \\
Timeline Match & {{ applicant.timeline_match }}\% \\
\hline
\end{tabularx}
\caption{Performance Metrics - {{ applicant.name }}}
\end{table}

\paragraph{Explanation}
{{ applicant.explanation }}

\paragraph{Key Strengths}
{{ applicant.strengths }}

\paragraph{Areas for Improvement}
{{ applicant.improvements }}

\paragraph{Summary Recommendation}
Based on the evaluation, this proposal {% if applicant.rank == 1 %}is the top-ranked submission with strong overall performance.{% elif applicant.rank <= 3 %}shows solid performance and warrants consideration.{% else %}meets basic requirements but has significant areas for improvement.{% endif %}

\newpage
{% endfor %}

\section{Strategic Recommendations}
Based on the evaluation results, the following recommendations are provided:

\begin{enumerate}
    \item \textbf{Top-Ranked Applicant:} The applicant with the highest compliance score ({{ applicants[0].name if applicants else "N/A" }}) should be considered for further review.
    \item \textbf{Compliance Threshold:} Only applicants scoring above the minimum threshold should be considered for contract award.
    \item \textbf{Further Due Diligence:} Conduct additional verification for the top-ranked applicants before final selection.
    \item \textbf{Negotiation Opportunities:} Consider negotiating terms with high-scoring applicants to optimize value.
\end{enumerate}

{% else %}
\section{No Applicants Evaluated}
No applicant proposals met the evaluation criteria or were successfully processed.
{% endif %}

\section{Evaluation Methodology}
The evaluation process followed these steps:

\begin{enumerate}
    \item \textbf{Document Processing:} Text extraction from PDF documents using pdfplumber with OCR fallback when necessary.
    \item \textbf{Embedding Generation:} Creation of vector representations using nomic-embed-text model.
    \item \textbf{Similarity Search:} Semantic matching between requirements and proposals using cosine similarity.
    \item \textbf{Rule-Based Filtering:} Application of budget, timeline, and certification constraints.
    \item \textbf{LLM Evaluation:} Detailed scoring and analysis using llama3.1 model.
\end{enumerate}

\end{document}